// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}


// -------------------------------------------------------------------------
// USER MODEL
// -------------------------------------------------------------------------
model User {
  id            Int           @id @default(autoincrement())
  lineUserId    String        @unique
  firstName     String
  lastName      String
  company       String?
  phoneNumber   String        @unique
  email         String        @unique
  tier          String        @default("BRONZE")
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  registerCode  String

  status        String        @default("PENDING")

  // Relations
  roles         UserRole[]
  companies     UserCompany[]
}


// -------------------------------------------------------------------------
// ROLE MASTER
// -------------------------------------------------------------------------
model Role {
  id    Int     @id @default(autoincrement())
  name  String  @unique
  userRoles UserRole[]
  rbacs Rbac[]
}

// -------------------------------------------------------------------------
// RBAC PERMISSION
// -------------------------------------------------------------------------
model Rbac {
  id         Int     @id @default(autoincrement())
  roleId     Int 
  viewPo     Boolean @default(false) 
  createPo   Boolean @default(false) 
  approvePo  Boolean @default(false)
  editPo     Boolean @default(false)

  role       Role    @relation(fields: [roleId], references: [id])
}

// -------------------------------------------------------------------------
// USER ↔ ROLE (Many-to-Many)
// -------------------------------------------------------------------------
model UserRole {
  id      Int  @id @default(autoincrement())
  userId  Int
  roleId  Int
  user    User @relation(fields: [userId], references: [id])
  role    Role @relation(fields: [roleId], references: [id])
}

// -------------------------------------------------------------------------
// COMPANY
// -------------------------------------------------------------------------
model Company {
  id            Int      @id @default(autoincrement())
  companyName   String
  creditAmount  Decimal   @db.Decimal(10, 2)
  CustID        Int
  users         UserCompany[]
}

// -------------------------------------------------------------------------
// USER ↔ COMPANY (Many-to-Many)
// -------------------------------------------------------------------------
model UserCompany {
  id        Int   @id @default(autoincrement())

  userId    Int
  companyId Int

  user      User    @relation(fields: [userId], references: [id])
  company   Company @relation(fields: [companyId], references: [id])
}

// -------------------------------------------------------------------------
// ADMIN (Backoffice)
// -------------------------------------------------------------------------
model Admin {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  firstName String
  lastName  String
  role      String   @default("ADMIN")
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
  @@index([role])
}
